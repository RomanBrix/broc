{"ast":null,"code":"import _classCallCheck from \"/Users/romabrix/GIT/brocompany/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/romabrix/GIT/brocompany/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/romabrix/GIT/brocompany/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/romabrix/GIT/brocompany/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/romabrix/GIT/brocompany/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/Users/romabrix/GIT/brocompany/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/Users/romabrix/GIT/brocompany/client/src/js/components/admin/NewsArticle.js\";\nimport React, { Component } from 'react';\nimport DraftJs from \"../layers/DraftJs\";\nimport SelfDayPicker from \"../layers/DayPicker\";\n\nvar NewsArticle =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(NewsArticle, _Component);\n\n  function NewsArticle(props) {\n    var _this;\n\n    _classCallCheck(this, NewsArticle);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(NewsArticle).call(this, props));\n    _this.state = {\n      news: {\n        title: 'New One',\n        photo: 'news.jpg',\n        shortDesc: 'Short Desc',\n        content: null,\n        tag: 'party',\n        date: new Date()\n      },\n      contForSave: null,\n      newPubDate: new Date(),\n      fileToUpload: null,\n      fileName: null,\n      imgPreview: null\n    };\n\n    if (props.match.params.id !== 'new') {\n      //Запрос на данные по id\n      var that = _assertThisInitialized(_assertThisInitialized(_this));\n\n      props.allFunctions('Get News By Id', {\n        id: props.match.params.id\n      }, function (res) {\n        if (res.length > 0) {\n          var willBeNews = res[0];\n          that.setState({\n            news: {\n              title: willBeNews.title,\n              photo: willBeNews.photo,\n              shortDesc: willBeNews.shortDesc,\n              content: willBeNews.content,\n              tag: willBeNews.tag,\n              date: willBeNews.created\n            }\n          });\n        }\n      }); // if id > null - redirect to 404 not found ;\n    }\n\n    return _this;\n  }\n\n  _createClass(NewsArticle, [{\n    key: \"dropdownChanged\",\n    value: function dropdownChanged(e) {\n      var newState = this.state.news;\n      newState.tag = e.target.value;\n      this.setState({\n        news: newState\n      });\n    }\n  }, {\n    key: \"titleChange\",\n    value: function titleChange(e) {\n      var lastNews = this.state.news;\n      lastNews.title = e.target.value;\n      this.setState({\n        news: lastNews\n      });\n    }\n  }, {\n    key: \"changeShortDesc\",\n    value: function changeShortDesc(e) {\n      var newState = this.state.news;\n      newState.shortDesc = e.target.value;\n      this.setState({\n        news: newState\n      });\n    }\n  }, {\n    key: \"setDayPub\",\n    value: function setDayPub(day, _ref) {\n      var selected = _ref.selected;\n      var news = this.state.news;\n      var newState = news;\n      newState.date = selected ? undefined : new Date(day);\n      this.setState({\n        news: newState\n      });\n    }\n  }, {\n    key: \"onChangeUpload\",\n    value: function onChangeUpload(e) {\n      // const newState = this.state.news;\n      if (e.target.files[0]) {\n        // newState.photo = e.target.files[0].name;\n        this.setState({\n          fileToUpload: e.target.files[0],\n          fileName: e.target.files[0].name,\n          imgPreview: URL.createObjectURL(e.target.files[0])\n        });\n      }\n    }\n  }, {\n    key: \"saveDraftJsContent\",\n    value: function saveDraftJsContent(content) {\n      this.setState({\n        contForSave: content\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      if (!this.props.adminLogin) {\n        return React.createElement(\"h1\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 99\n          },\n          __self: this\n        }, \"Check user\");\n      }\n\n      var _this$state = this.state,\n          news = _this$state.news,\n          imgPreview = _this$state.imgPreview; // eslint-disable-next-line\n\n      var getTag = 'Развлечение';\n\n      switch (news.tag) {\n        case 'party':\n          getTag = React.createElement(\"div\", {\n            className: \"tag mint-tag\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 107\n            },\n            __self: this\n          }, \"\\u0420\\u0430\\u0437\\u0432\\u043B\\u0435\\u0447\\u0435\\u043D\\u0438\\u0435\");\n          break;\n\n        case 'paertners':\n          getTag = React.createElement(\"div\", {\n            className: \"tag pink-tag\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 110\n            },\n            __self: this\n          }, \"\\u041F\\u0430\\u0440\\u0442\\u043D\\u0435\\u0440\\u0441\\u0442\\u0432\\u043E\");\n          break;\n\n        case 'local':\n          getTag = React.createElement(\"div\", {\n            className: \"tag green-tag\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 113\n            },\n            __self: this\n          }, \"\\u041B\\u043E\\u043A\\u0430\\u043B\\u044C\\u043D\\u044B\\u0435\");\n          break;\n\n        case 'trade':\n          getTag = React.createElement(\"div\", {\n            className: \"tag green-tag\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 116\n            },\n            __self: this\n          }, \"\\u0411\\u0438\\u0440\\u0436\\u0430\");\n          break;\n\n        default:\n          getTag = '';\n      }\n\n      var imgSrc = '/src/news/' + news.photo;\n\n      if (imgPreview !== null) {\n        imgSrc = imgPreview;\n      }\n\n      return React.createElement(\"div\", {\n        className: \"admin-news-article\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 128\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        type: \"text\",\n        value: news.title,\n        onChange: this.titleChange.bind(this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 129\n        },\n        __self: this\n      }), React.createElement(\"select\", {\n        name: \"tag\",\n        value: news.tag,\n        onChange: this.dropdownChanged.bind(this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 131\n        },\n        __self: this\n      }, React.createElement(\"option\", {\n        value: \"party\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 132\n        },\n        __self: this\n      }, \"\\u0420\\u0430\\u0437\\u0432\\u043B\\u0435\\u0447\\u0435\\u043D\\u0438\\u0435\"), React.createElement(\"option\", {\n        value: \"paertners\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 133\n        },\n        __self: this\n      }, \"\\u041F\\u0430\\u0440\\u0442\\u043D\\u0435\\u0440\\u0441\\u0442\\u0432\\u043E\"), React.createElement(\"option\", {\n        value: \"local\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 134\n        },\n        __self: this\n      }, \"\\u041B\\u043E\\u043A\\u0430\\u043B\\u044C\\u043D\\u044B\\u0435\"), React.createElement(\"option\", {\n        value: \"trade\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 135\n        },\n        __self: this\n      }, \"\\u0411\\u0438\\u0440\\u0436\\u0430\")), React.createElement(\"h3\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 139\n        },\n        __self: this\n      }, \"\\u041A\\u0440\\u0430\\u0442\\u043A\\u043E\\u0435 \\u043E\\u043F\\u0438\\u0441\\u0430\\u043D\\u0438\\u0435:\"), React.createElement(\"textarea\", {\n        name: \"shortDesc\",\n        id: \"shortDesc\",\n        ref: 'shortDesc',\n        value: news.shortDesc,\n        onChange: this.changeShortDesc.bind(this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 140\n        },\n        __self: this\n      }), React.createElement(\"h2\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 145\n        },\n        __self: this\n      }, \"\\u0414\\u0430\\u0442\\u0430 \\u043F\\u0443\\u0431\\u043B\\u0438\\u043A\\u0430\\u0446\\u0438\\u0438\"), React.createElement(SelfDayPicker, {\n        selectedDay: new Date(this.state.news.date),\n        setDay: this.setDayPub.bind(this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 146\n        },\n        __self: this\n      }), React.createElement(\"h2\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154\n        },\n        __self: this\n      }, \"\\u0424\\u043E\\u0442\\u043E:\"), React.createElement(\"div\", {\n        className: 'photo-load',\n        style: {\n          backgroundImage: \"url(\".concat(imgSrc, \")\")\n        },\n        onClick: function onClick() {\n          var fff = document.getElementById('file');\n          fff.click();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 155\n        },\n        __self: this\n      }), React.createElement(\"input\", {\n        type: \"file\",\n        name: \"myImage\",\n        onChange: this.onChangeUpload.bind(this),\n        id: 'file',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160\n        },\n        __self: this\n      }), React.createElement(DraftJs, {\n        saveDraftJsContent: this.saveDraftJsContent.bind(this),\n        content: news.content,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 166\n        },\n        __self: this\n      }), this.props.match.params.id === 'new' ? React.createElement(\"div\", {\n        className: \"btn-add\",\n        onClick: function onClick() {\n          var _this2$state = _this2.state,\n              news = _this2$state.news,\n              fileName = _this2$state.fileName,\n              fileToUpload = _this2$state.fileToUpload,\n              contForSave = _this2$state.contForSave;\n          var stateForSave = news;\n          stateForSave.content = contForSave;\n\n          if (fileToUpload !== null) {\n            var formData = new FormData();\n            formData.append('myImage', _this2.state.fileToUpload);\n            stateForSave.photo = fileName;\n\n            _this2.props.allFunctions('upload-file', {\n              file: formData\n            });\n          }\n\n          _this2.props.allFunctions('add-news', {\n            news: stateForSave\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 170\n        },\n        __self: this\n      }, \"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C\") : React.createElement(\"div\", {\n        className: \"btns\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 186\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"btn-save\",\n        onClick: function onClick() {\n          _this2.saveContent();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187\n        },\n        __self: this\n      }, \"\\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0438\\u0442\\u044C\"), React.createElement(\"div\", {\n        className: \"btn-delete\",\n        onClick: function onClick() {\n          _this2.deleteNews();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191\n        },\n        __self: this\n      }, \"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C\")));\n    }\n  }, {\n    key: \"saveContent\",\n    value: function saveContent() {\n      var _this$state2 = this.state,\n          news = _this$state2.news,\n          fileName = _this$state2.fileName,\n          fileToUpload = _this$state2.fileToUpload,\n          contForSave = _this$state2.contForSave;\n      var stateForSave = news;\n      stateForSave.content = contForSave;\n\n      if (fileToUpload !== null) {\n        var formData = new FormData();\n        formData.append('myImage', this.state.fileToUpload);\n        stateForSave.photo = fileName;\n        this.props.allFunctions('upload-file', {\n          file: formData\n        });\n      }\n\n      this.props.allFunctions('Update News By Id', {\n        news: stateForSave,\n        id: this.props.match.params.id\n      }, function (res) {\n        console.log(res);\n\n        if (res.ok == 1) {\n          alert('Saved');\n        }\n      });\n    }\n  }, {\n    key: \"deleteNews\",\n    value: function deleteNews() {\n      var _this3 = this;\n\n      this.props.allFunctions('Delete News By Id', {\n        id: this.props.match.params.id\n      }, function (res) {\n        console.log(res);\n\n        if (res.ok == 1) {\n          alert('Deleted');\n\n          _this3.props.history.push('/adminka/news');\n        }\n      });\n    }\n  }]);\n\n  return NewsArticle;\n}(Component);\n\nexport { NewsArticle as default };","map":{"version":3,"sources":["/Users/romabrix/GIT/brocompany/client/src/js/components/admin/NewsArticle.js"],"names":["React","Component","DraftJs","SelfDayPicker","NewsArticle","props","state","news","title","photo","shortDesc","content","tag","date","Date","contForSave","newPubDate","fileToUpload","fileName","imgPreview","match","params","id","that","allFunctions","res","length","willBeNews","setState","created","e","newState","target","value","lastNews","day","selected","undefined","files","name","URL","createObjectURL","adminLogin","getTag","imgSrc","titleChange","bind","dropdownChanged","changeShortDesc","setDayPub","backgroundImage","fff","document","getElementById","click","onChangeUpload","saveDraftJsContent","stateForSave","formData","FormData","append","file","saveContent","deleteNews","console","log","ok","alert","history","push"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\nimport DraftJs from \"../layers/DraftJs\";\nimport SelfDayPicker from \"../layers/DayPicker\";\n\nexport default class NewsArticle extends Component {\n    constructor(props){\n        super(props);\n\n            this.state = {\n                news: {\n                    title: 'New One',\n                    photo: 'news.jpg',\n                    shortDesc: 'Short Desc',\n                    content: null,\n                    tag: 'party',\n                    date: new Date()\n                },\n                contForSave: null,\n                newPubDate: new Date(),\n                fileToUpload: null,\n                fileName: null,\n                imgPreview: null\n            };\n        if(props.match.params.id !== 'new') {\n                //Запрос на данные по id\n            const that  = this;\n            props.allFunctions('Get News By Id',{id: props.match.params.id}, (res)=>{\n                if(res.length > 0 ){\n                    const willBeNews = res[0];\n                    that.setState({\n                        news: {\n                            title: willBeNews.title,\n                            photo: willBeNews.photo,\n                            shortDesc: willBeNews.shortDesc,\n                            content: willBeNews.content,\n                            tag: willBeNews.tag,\n                            date: willBeNews.created\n                        }\n                    })\n                }\n            })\n            // if id > null - redirect to 404 not found ;\n        }\n    }\n\n\n    dropdownChanged(e){\n        const newState = this.state.news;\n        newState.tag = e.target.value;\n        this.setState({\n            news: newState\n        });\n    }\n    titleChange(e){\n        const lastNews = this.state.news;\n        lastNews.title = e.target.value;\n        this.setState({\n            news: lastNews\n        })\n    }\n    changeShortDesc(e){\n        const newState = this.state.news;\n        newState.shortDesc = e.target.value;\n        this.setState({\n            news: newState\n        });\n    }\n    setDayPub(day, { selected }) {\n        const { news } = this.state;\n        const newState = news;\n        newState.date = selected ? undefined : new Date(day);\n        this.setState({\n            news: newState\n        });\n\n    }\n    onChangeUpload(e){\n        // const newState = this.state.news;\n        if(e.target.files[0]) {\n            // newState.photo = e.target.files[0].name;\n            this.setState({\n                fileToUpload: e.target.files[0],\n                fileName: e.target.files[0].name,\n                imgPreview: URL.createObjectURL(e.target.files[0])\n            })\n        }\n    }\n\n    saveDraftJsContent(content){\n\n        this.setState({\n            contForSave: content\n        })\n    }\n\n\n    render() {\n        if(!this.props.adminLogin){\n            return <h1>Check user</h1>\n        }\n        const { news, imgPreview } = this.state;\n\n// eslint-disable-next-line\n        let getTag = 'Развлечение';\n        switch (news.tag) {\n            case 'party':\n                getTag = <div className=\"tag mint-tag\">Развлечение</div>;\n                break;\n            case 'paertners':\n                getTag = <div className=\"tag pink-tag\" >Партнерство</div>;\n                break;\n            case 'local':\n                getTag = <div className=\"tag green-tag\">Локальные</div>;\n                break;\n            case 'trade':\n                getTag = <div className=\"tag green-tag\">Биржа</div>;\n                break;\n            default:\n                getTag = '';\n        }\n\n        let imgSrc = '/src/news/' + news.photo;\n        if(imgPreview !== null){\n            imgSrc = imgPreview;\n        }\n\n        return (\n            <div className=\"admin-news-article\">\n                <input type=\"text\" value={news.title} onChange={this.titleChange.bind(this)}/>\n\n                <select name=\"tag\" value={news.tag} onChange={this.dropdownChanged.bind(this)}>\n                    <option value=\"party\">Развлечение</option>\n                    <option value=\"paertners\" >Партнерство</option>\n                    <option value=\"local\" >Локальные</option>\n                    <option value=\"trade\" >Биржа</option>\n\n                </select>\n\n                <h3>Краткое описание:</h3>\n                <textarea name=\"shortDesc\" id=\"shortDesc\" ref={'shortDesc'} value={news.shortDesc} onChange={this.changeShortDesc.bind(this)}/>\n\n\n\n                {/*////date*/}\n                <h2>Дата публикации</h2>\n                <SelfDayPicker\n                    selectedDay={new Date(this.state.news.date)}\n                    setDay={this.setDayPub.bind(this)}\n                />\n\n\n\n                {/*/////photo*/}\n                <h2>Фото:</h2>\n                <div className={'photo-load'} style={{backgroundImage: `url(${imgSrc})`}} onClick={()=>{\n                    const fff = document.getElementById('file');\n                    fff.click();\n                }}/>\n\n                <input type=\"file\" name=\"myImage\" onChange={this.onChangeUpload.bind(this)} id={'file'}/>\n\n\n\n\n                {/*/////content*/}\n                <DraftJs saveDraftJsContent={this.saveDraftJsContent.bind(this)} content={news.content}/>\n\n                {\n                    this.props.match.params.id === 'new' ?\n                        <div className=\"btn-add\" onClick={()=>{\n                            const { news, fileName, fileToUpload, contForSave} = this.state;\n                            const stateForSave = news;\n                            stateForSave.content = contForSave;\n\n                            if(fileToUpload !== null){\n                                let formData = new FormData();\n                                    formData.append('myImage', this.state.fileToUpload);\n\n                                stateForSave.photo = fileName;\n                                this.props.allFunctions('upload-file',{file: formData});\n                            }\n                            this.props.allFunctions('add-news',{news: stateForSave});\n\n                        }}>Добавить</div>\n                        :\n                        <div className=\"btns\">\n                            <div className=\"btn-save\" onClick={()=>{\n                                this.saveContent();\n                            }}>Сохранить</div>\n\n                            <div className=\"btn-delete\" onClick={()=>{this.deleteNews()}}>Удалить</div>\n                        </div>\n                }\n            </div>\n        )\n    }\n\n    saveContent(){\n        const { news, fileName, fileToUpload, contForSave} = this.state;\n        const stateForSave = news;\n        stateForSave.content = contForSave;\n\n        if(fileToUpload !== null){\n            let formData = new FormData();\n            formData.append('myImage', this.state.fileToUpload);\n\n            stateForSave.photo = fileName;\n            this.props.allFunctions('upload-file',{file: formData});\n        }\n\n        this.props.allFunctions('Update News By Id',{news: stateForSave, id: this.props.match.params.id }, (res)=>{\n            console.log(res);\n            if(res.ok == 1){\n                alert('Saved');\n            }\n        });\n\n    }\n    deleteNews(){\n        this.props.allFunctions('Delete News By Id',{id: this.props.match.params.id }, (res)=>{\n            console.log(res);\n            if(res.ok == 1){\n                alert('Deleted');\n                this.props.history.push('/adminka/news');\n            }\n        });\n    }\n}"]},"metadata":{},"sourceType":"module"}